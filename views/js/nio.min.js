var crec=null,cpage="",chkStr=(a,b,c)=>{return a.charAt(b)===c?a.substring(0,b)+a.substring(b+1,a.length):a},removeZeroes=a=>{var b=a.split("/");return 1<b.length&&("0"==b[0].charAt(0)&&(b[0]=b[0].slice(1)),"0"==b[1].charAt(0)&&(b[1]=b[1].slice(1))),b.join("/")},Reverse8601=a=>{var b=a;-1<a.indexOf("T")&&(b.split("T"),b.pop(),b.join("")),b=b.split("/");var c="";return c+=chkStr(b[0],0,"0")+"/"+chkStr(b[1],0,"0")+"/"+b[2],c},writeLiveRecord=()=>{for(var a=0;a<record.nio.notinoffice.length;a++)(record.nio.notinoffice[a].hasOwnProperty("indicie")||"undefined"!=record.nio.notinoffice[a].indicie)&&delete record.nio.notinoffice[a].indicie;jsonfile.writeFile(prepend+filenames[2],record.nio,b=>{null!==b&&console.error(b)})},getRecordByEvent=a=>{for(var b=Reverse8601(a.start.format("MM/DD/YYYY")),c=[],e=0;e<record.nio.notinoffice.length;e++)record.nio.notinoffice[e].name==lname&&record.nio.notinoffice[e].type==cpage&&record.nio.notinoffice[e].date==b&&(c.push(record.nio.notinoffice[e]),c[c.length-1].indicie=e);if(1==c.length)return c[0];for(var g,f=0;f<c.length;e++)if(g=Reverse8601(a.end.format("MM/DD/YYYY")),c[f].dateend==g)return c[f];return null};$(document).ready(function(){cpage=currentPage().split(".")[0],eventEmitter.on("nio",a=>{if(null===record.nio)readNIO(b=>{return null===b?a(null):(console.error(b),alert("An error has occurred reading not in office information.\n"+b),a(b))});else if(null!==record.nio)return a(null)}),$("#isMultiDay").on("change",function(){var a=document.getElementById("isMultiDay"),b=a.checked;b?($("#EndDate").stop(!0,!0).slideDown(),$("#timeOffFullDay").prop("checked",!0),$("#timeOffAm").attr("disabled",!0),$("#timeOffPm").attr("disabled",!0),$("#timeOffFullDay").attr("disabled",!0),""==$("#datepicker2").val()&&$("#addnio").attr("disabled",!0)):($("#EndDate").stop(!0,!0).slideUp(),$("#timeOffAm").attr("disabled",!1),$("#timeOffPm").attr("disabled",!1),$("#timeOffFullDay").attr("disabled",!1))}),$("#isMultiDay2").on("change",function(){var a=document.getElementById("isMultiDay2"),b=a.checked;b?($("#EndDate2").stop(!0,!0).slideDown(),$("#timeOffFullDay2").prop("checked",!0),$("#timeOffAm2").attr("disabled",!0),$("#timeOffPm2").attr("disabled",!0),$("#timeOffFullDay2").attr("disabled",!0),""==$("#datepicker4").val()&&$("#savenio").attr("disabled",!0)):($("#EndDate2").stop(!0,!0).slideUp(),$("#timeOffAm2").attr("disabled",!1),$("#timeOffPm2").attr("disabled",!1),$("#timeOffFullDay2").attr("disabled",!1))}),eventEmitter.on("notLoggedIn",()=>{alert("You must be logged in to access this page.\nYou will be redirected."),window.location.href="index.ejs"}),eventEmitter.on("delNIO",()=>{var a=confirm("Are you sure you want to delete the "+cpage.toUpperCase()+" record?");a&&($("#calendar").fullCalendar("removeEvents",b=>{return b.title==lname&&removeZeroes(b.start.format("MM/DD/YYYY"))==crec.date}),$("#events-modal").modal("hide"),record.nio.notinoffice.splice(crec.indicie,1),writeLiveRecord())}),$("#datepicker").on("change",function(){var a=moment($(this).val());if(!a.isValid()){var b=new Date,c=b.getFullYear(),e=b.getMonth()+1,f=b.getDate();$(this).val(e+"/"+f+"/"+c)}else{var g=$(this).val(),h=moment($("#datepicker2").val());g=g.split("/"),1<g.length&&("0"==g[0].charAt(0)&&(g[0]=g[0].slice(1)),"0"==g[1].charAt(0)&&(g[1]=g[1].slice(1)),$(this).val(g.join("/"))),a.isAfter(h)&&$("#datepicker2").val($(this).val())}(document.getElementById("isMultiDay").checked&&""!=$("#datepicker2").val()||!document.getElementById("isMultiDay").checked)&&$("#addnio").attr("disabled",!1)}),$("#datepicker2").on("change",function(){var a=moment($(this).val()),b=moment($("#datepicker").val());if(!(!a.isValid()||a.isBefore(b))){var c=$(this).val();c=c.split("/"),1<c.length&&("0"==c[0].charAt(0)&&(c[0]=c[0].slice(1)),"0"==c[1].charAt(0)&&(c[1]=c[1].slice(1)),$(this).val(c.join("/")))}else if(b.isValid()){$(this).val(b.format("MM/DD/YYYY"));var c=$(this).val();c=c.split("/"),1<c.length&&("0"==c[0].charAt(0)&&(c[0]=c[0].slice(1)),"0"==c[1].charAt(0)&&(c[1]=c[1].slice(1)),$(this).val(c.join("/")))}else{var e=new Date,f=e.getFullYear(),g=e.getMonth()+1,h=e.getDate();$(this).val(g+"/"+h+"/"+f)}""==$("#datepicker").val()&&$("#datepicker").val($(this).val()),$("#addnio").attr("disabled",!1)}),$("#datepicker3").on("change",function(){var a=moment($(this).val());if(!a.isValid()){var b=new Date,c=b.getFullYear(),e=b.getMonth()+1,f=b.getDate();$(this).val(e+"/"+f+"/"+c)}else{var g=$(this).val(),h=moment($("#datepicker4").val());g=g.split("/"),1<g.length&&("0"==g[0].charAt(0)&&(g[0]=g[0].slice(1)),"0"==g[1].charAt(0)&&(g[1]=g[1].slice(1)),$(this).val(g.join("/"))),a.isAfter(h)&&$("#datepicker4").val($(this).val())}(document.getElementById("isMultiDay2").checked&&""!=$("#datepicker4").val()||!document.getElementById("isMultiDay2").checked)&&$("#savenio").attr("disabled",!1)}),$("#datepicker4").on("change",function(){var a=moment($(this).val()),b=moment($("#datepicker3").val());if(!(!a.isValid()||a.isBefore(b))){var c=$(this).val();c=c.split("/"),1<c.length&&("0"==c[0].charAt(0)&&(c[0]=c[0].slice(1)),"0"==c[1].charAt(0)&&(c[1]=c[1].slice(1)),$(this).val(c.join("/")))}else if(b.isValid()){$(this).val(b.format("MM/DD/YYYY"));var c=$(this).val();c=c.split("/"),1<c.length&&("0"==c[0].charAt(0)&&(c[0]=c[0].slice(1)),"0"==c[1].charAt(0)&&(c[1]=c[1].slice(1)),$(this).val(c.join("/")))}else{var e=new Date,f=e.getFullYear(),g=e.getMonth()+1,h=e.getDate();$(this).val(g+"/"+h+"/"+f)}""==$("#datepicker3").val()&&$("#datepicker3").val($(this).val()),$("#savenio").attr("disabled",!1)}),$("#savenio").on("click",()=>{$("#calendar").fullCalendar("removeEvents",f=>{return f.title==lname&&removeZeroes(f.start.format("MM/DD/YYYY"))==crec.date}),record.nio.notinoffice.splice(crec.indicie,1);var a={name:lname,date:$("#datepicker3").val(),time:document.getElementById("timeOffAm2").checked?"4am":document.getElementById("timeOffPm2").checked?"4pm":"8hr",type:cpage.toLowerCase()},b={title:lname,start:ISO86Date($("#datepicker3").val(),document.getElementById("timeOffAm2").checked?"4am":document.getElementById("timeOffPm2").checked?"4pm":"8hr"),color:"pto"==cpage?"rgba(238, 51, 78, 0.4)":"rgba(0, 0, 255, 0.4)",textColor:"rgba(255, 255, 255, 1)"};if(document.getElementById("isMultiDay2").checked){var c=moment($("#datepicker4").val()).add(1,"days").format("MM/DD/YYYY");a.dateend=removeZeroes(c);var e=c.split("/");1<e.length&&("0"==e[0].charAt(0)&&(e[0]=e[0].slice(1)),"0"==e[1].charAt(0)&&(e[1]=e[1].slice(1))),c=e.join("/"),b.end=ISO86Date(c,document.getElementById("timeOffAm2").checked?"4am":document.getElementById("timeOffPm2").checked?"4pm":"8hr")}$("#calendar").fullCalendar("renderEvent",b),record.nio.notinoffice.push(a),writeLiveRecord(),$("#events-modal").modal("hide")}),$("#addnio").on("click",()=>{var a=$("#datepicker").val(),b=moment($("#datepicker2").val()),c=b.add(1,"days").format("MM/DD/YYYY"),e=c.split("/");1<e.length&&("0"==e[0].charAt(0)&&(e[0]=e[0].slice(1)),"0"==e[1].charAt(0)&&(e[1]=e[1].slice(1))),c=e.join("/");var f=document.getElementById("isMultiDay").checked,g=document.getElementById("timeOffAm").checked,h=document.getElementById("timeOffPm").checked,j=document.getElementById("timeOffFullDay").checked,k=["4am","4pm","8hr"],l=0;h&&(l=1),j&&(l=2);var n={},o={};n.start=ISO86Date(a,k[l]),n.title=lname,n.color="pto"==cpage?"rgba(238, 51, 78, 0.4)":"rgba(0, 0, 255, 0.4)",n.textColor="rgba(255, 255, 255, 1)",f&&(n.end=ISO86Date(c,k[l])),$("#calendar").fullCalendar("renderEvent",n),$("#addnew-modal").modal("hide"),o.name=lname,o.date=a,o.time=k[l],o.type=cpage,f&&(o.dateend=c),record.nio.notinoffice.push(o),writeLiveRecord()}),eventEmitter.on("loggedIn",()=>{eventEmitter.emit("nio",a=>{if(null===a){for(var b=record.nio.notinoffice,c=[],e=0;e<b.length;e++)b[e].name==lname&&b[e].type==cpage&&(c.push({title:b[e].name,start:ISO86Date(b[e].date,b[e].time)}),b[e].hasOwnProperty("dateend")&&(c[c.length-1].end=ISO86Date(b[e].dateend,b[e].time)));$("#calendar").fullCalendar({themeSystem:"bootstrap4",customButtons:{AddNew:{text:"Add New "+cpage.toUpperCase(),click:function(){$("#addnew-modal").modal(),$("#addnew-title").html("<i class='fa fa-file'></i> Add New "+cpage.toUpperCase())}}},header:{left:"prev today AddNew",center:"title",right:"next"},editable:!0,eventLimit:!0,weekNumbers:!0,eventOverlap:!1,eventSources:[{events:c,color:"pto"==cpage?"rgba(238, 51, 78, 0.4)":"rgba(0, 0, 255, 0.4)",textColor:"rgba(255, 255, 255, 1)"}],eventRender:function(f,g){g.popover({title:f.title,content:cpage.toUpperCase()+" for "+lname,trigger:"hover",placement:"top",container:"body"})},eventResizeStop:function(f){crec=null,crec=getRecordByEvent(f)},eventResize:function(f,g,h){null!==crec&&record.nio.notinoffice.splice(crec.indicie,1),delete crec.indicie;var j=Reverse8601(f.start.format("MM/DD/YYYY")),k=null;null!==f.end&&(k=Reverse8601(f.end.format("MM/DD/YYYY")));var l=Reverse8601(moment(f.start,"DD-MM-YYYY").add(1,"days").format("MM/DD/YYYY")),n=f.title;confirm("Are you sure you want to resize this?")?(record.nio.notinoffice.push({name:n,date:j,dateend:k,time:crec.time,type:cpage}),null==record.nio.notinoffice[record.nio.notinoffice.length-1].dateend&&delete record.nio.notinoffice[record.nio.notinoffice.length-1].dateend):(record.nio.notinoffice.push(crec),h()),"undefined"!=typeof record.nio.notinoffice[record.nio.notinoffice.length-1].indicie&&delete record.nio.notinoffice[record.nio.notinoffice.length-1].indicie,writeLiveRecord()},eventDragStop:function(f){crec=null,crec=getRecordByEvent(f)},eventDrop:function(f,g,h){null!==crec&&record.nio.notinoffice.splice(crec.indicie,1),delete crec.indicie;var n=Reverse8601(f.start.format("MM/DD/YYYY")),o=null;null!==f.end&&(o=Reverse8601(f.end.format("MM/DD/YYYY")));var p=Reverse8601(moment(f.start,"DD-MM-YYYY").add(1,"days").format("MM/DD/YYYY")),q=f.title;confirm("Are you sure you want to move this?")?(record.nio.notinoffice.push({name:q,date:n,dateend:o,time:crec.time,type:cpage}),null==record.nio.notinoffice[record.nio.notinoffice.length-1].dateend&&delete record.nio.notinoffice[record.nio.notinoffice.length-1].dateend):(delete crec.indicie,record.nio.notinoffice.push(crec),h()),"undefined"!=typeof record.nio.notinoffice[record.nio.notinoffice.length-1].indicie&&delete record.nio.notinoffice[record.nio.notinoffice.length-1].indicie,writeLiveRecord()},eventClick:function(f){if(crec=null,crec=getRecordByEvent(f),$("#datepicker3").val(crec.date),$("#isMultiDay2").prop("checked",!1),crec.hasOwnProperty("dateend")){var j=moment(crec.dateend).subtract(1,"days").format("MM/DD/YYYY"),k=j.split("/");$("#isMultiDay2").prop("checked",!0),1<k.length&&("0"==k[0].charAt(0)&&(k[0]=k[0].slice(1)),"0"==k[1].charAt(0)&&(k[1]=k[1].slice(1))),j=k.join("/"),$("#datepicker4").val(j),$("#EndDate2").removeClass("hidden"),$("#timeOffAm2").prop("checked",!1),$("#timeOffPm2").prop("checked",!1),$("#timeOffFullDay2").prop("checked",!0),$("#timeOffAm2").prop("disabled",!0),$("#timeOffPm2").prop("disabled",!0),$("#timeOffFullDay2").prop("disabled",!0),$("#savenio").prop("disabled",!1)}else $("#timeOffAm2").prop("checked","4am"==crec.time),$("#timeOffPm2").prop("checked","4pm"==crec.time),$("#timeOffFullDay2").prop("checked","8hr"==crec.time);$("#events-modal").modal({})}})}else console.error(a),alert("An error has occurred:\n"+a)})})});